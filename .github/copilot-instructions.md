Project: Vesterled Svømmehal (Next.js + Sanity)

This file contains concise, project-specific guidance for AI coding agents working in this repository.

Key architecture

- Next.js App Router project (app/). Main public UI lives under `src/app/(frontend)` and pages like posts and posts/[slug] are server components.
- Sanity is embedded via `next-sanity` and a Studio is mounted at `/studio` using `src/app/studio/[[...tool]]/page.tsx` which renders `NextStudio` with `sanity.config.ts`.
- Sanity client and live helpers live in `src/sanity/lib/`:
  - `client.ts` exports `client` (next-sanity createClient)
  - `live.ts` exports `{ sanityFetch, SanityLive }` for live-updating queries
  - `queries.ts` contains GROQ queries (e.g. `SITE_SETTINGS_QUERY`, `POSTS_QUERY`, `POST_QUERY`).
  - `image.ts` exports `urlFor` helper for building Sanity image URLs.

Important files to reference

- `package.json` for scripts: `npm run dev`, `npm run build`, `npm run start`, `npm run typegen` (typegen runs `sanity schema extract` and `sanity typegen generate`).
- `sanity.config.ts` and `src/sanity/env.ts` — env vars are required: `NEXT_PUBLIC_SANITY_PROJECT_ID`, `NEXT_PUBLIC_SANITY_DATASET`, `NEXT_PUBLIC_SANITY_API_VERSION`.
- `src/sanity/types.ts` is generated by Sanity TypeGen; do not edit manually.
- `src/app/layout.tsx` and `src/app/globals.css` for global wrappers and theme data attribute.

Conventions & patterns

- Server vs Client components: most page files are async server components (use `export default async function Page()`), use `sanityFetch` in server components to fetch content. `live.ts` provides live fetching when `SanityLive` is mounted.
- Type generation: keep `src/sanity/extract.json` and run `npm run typegen` before `dev`/`build`. Pre-commit hooks or CI should ensure types are generated when schema changes.
- Image URLs: use `urlFor(source).width(...).url()` from `src/sanity/lib/image.ts` when rendering images.
- Studio: The Studio is set to `basePath: '/studio'` in `sanity.config.ts`. The Next route `src/app/studio/[[...tool]]/page.tsx` uses `NextStudio` and exports `dynamic = 'force-static'`.

Developer workflows (commands)

- Local dev: `npm run dev` (runs `next dev`). Studio is available at `http://localhost:3000/studio`.
- Build: `npm run build` then `npm run start` for production serving.
- Type generation (must run before `dev`/`build` when schema changed): `npm run typegen`.

Integration notes for agents

- Do not edit `src/sanity/types.ts` — it is generated. Instead update Sanity schema files under `src/sanity/schemaTypes` then run `npm run typegen`.
- When adding queries, follow existing `defineQuery` usage in `src/sanity/lib/queries.ts` and export matching TypeGen shapes.
- Prefer using `sanityFetch({ query: ..., params })` for data access in server components; use `SanityLive` only when live updates are desired.
- Respect `useCdn: true` in `client.ts` unless changing content-refresh strategy (ISR, on-demand revalidation) — adjust accordingly.

Examples (copyable patterns)

- Fetch site settings for metadata (used in `src/app/layout.tsx`):
  const { data: siteSettings } = await sanityFetch({ query: SITE_SETTINGS_QUERY });

- Define a query in `src/sanity/lib/queries.ts`:
  export const POST_QUERY = defineQuery(`*[_type == "post" && slug.current == $slug][0]{ _id, title, body, ... }`);

Edge cases and gotchas

- Missing env vars will throw at runtime — `src/sanity/env.ts` asserts presence. CI and local env must provide Sanity vars.
- Sanity TypeGen will overwrite `src/sanity/types.ts`. Keep schema edits in `src/sanity/schemaTypes`.

If anything here is unclear or you need examples for a new task (adding a query, creating a page, or changing Studio tools), tell me which area and I'll expand with precise code edits.
